#+TITLE:  Org Generate Pages
#+AUTHOR: Xavier Garrido
#+DATE:   2014-02-09

This file is used to publish a =org= documentation to =html= and to =pdf= into a =doc/= directory.

* Project publish functions
Within the next sections, we will define two publishing projects :
- an HTML exporter,
- a PDF exporter.
We first clean the list of publich project and then add the HTML & PDF exporters
#+BEGIN_SRC emacs-lisp
  (unless (boundp 'org-publish-project-alist)
    (setq org-publish-project-alist nil))
#+END_SRC
We also globally define the current directory
#+BEGIN_SRC emacs-lisp
  (setq this-directory (substitute-in-file-name "$OGP_EXPORT_DIR/"))
  (setq doc-directory (concat this-directory "doc/"))
  (setq base-name (file-name-nondirectory (directory-file-name this-directory)))
  (setq org-publish-timestamp-directory (concat "/tmp/org-timestamps/" base-name "/"))
#+END_SRC

* HTML export
** Requirements
#+BEGIN_SRC emacs-lisp
  (require 'ox-html)
#+END_SRC
** Use unicode for checkbox
#+BEGIN_SRC emacs-lisp
  (setq org-html-checkbox-type "unicode")
#+END_SRC
** Ensure \LaTeX code are not interpreted
#+BEGIN_SRC emacs-lisp
  (defvar org-babel-default-header-args:latex
    '((:results . "drawer") (:exports . "results")))
#+END_SRC
** Embedded Javascript code
*** TOC popup
#+NAME: toc.js
#+BEGIN_SRC js :results output :tangle no
  function displayTOC() {
      var ttoc = document.getElementById(\"text-table-of-contents\");
      if (ttoc) {
          var maincontent = '<a class=\"button\"><i class=\"fa fa-list\"></i></a>'
          maincontent += \"<div>\" + ttoc.innerHTML + \"</div>\";
          document.getElementById(\"toc\").innerHTML = maincontent;
      } else {
          document.getElementById(\"toc\").style.display = \"none\";
          document.getElementById(\"preamble\").style.top = \"10px\";
      }
     }
#+END_SRC

*** Random link color
#+NAME: rlc.js
#+BEGIN_SRC js :results output :tangle no
  function randomLinkColor() {
      var colors = [__colors__];
      var random_color = colors[Math.floor(Math.random() * colors.length)];
      var elements = document.querySelectorAll('a');
      [].slice.call(elements).forEach(function(elem) {
          //elem.style.color = random_color;
      });
  }
#+END_SRC
*** Setting emacs to use Javascript
#+BEGIN_SRC emacs-lisp :noweb yes
  (setq org-html-scripts (concat org-html-scripts "<script type=\"text/javascript\">
    <<rlc.js>>
    <<toc.js>>
    </script>
    "))
#+END_SRC

** Mathjax configuration
#+BEGIN_SRC emacs-lisp :noweb yes
    ;; (setq org-html-mathjax-options '((path  "http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")))
  (setq org-html-mathjax-template "<script type=\"text/x-mathjax-config\">
    <<mathjax.js>>
    </script>
    <script type=\"text/javascript\" src=\"http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\"></script>
    <div id=\"spinner\">
      <div id=\"bounce1\"></div>
      <div id=\"bounce2\"></div>
      <div id=\"bounce3\"></div>
      <small>Loading MathJax...</small>
    </div>")
#+END_SRC
*** Javascript code for Mathjax
#+NAME: mathjax.js
#+BEGIN_SRC js :results output :tangle no
  MathJax.Hub.Config({
      messageStyle: \"none\",
      TeX: {
          extensions: [\"cancel.js\"],
          Macros: {
              vv: [\"{\\\\vec{#1}}\",1],
              d: \"{\\\\text{d}}\",
              Upsigma: \"{\\\\Sigma}\",
              Updelta: \"{\\\\Delta}\",
              varoiint: \"{\\\\iint}\",
              varoint: \"{\\\\int}\",
              grad: \"{\\\\vec{\\\\nabla}}\",
              div: \"{\\\\vec{\\\\nabla}.}\",
              rot: \"{\\\\vec{\\\\nabla}\\\\times\\\\,}\",
              ket: [\"{|#1 \\\\rangle}\",1],
              bra: [\"{\\\\langle#1|}\",1],
              psh: [\"{\\\\langle#1|#2 \\\\rangle}\",2],
              bm: [\"{\\\\boldsymbol #1}\",1]
          }
      }
  });
  MathJax.Hub.Register.StartupHook(\"TeX Jax Ready\",function () {
      var TEX = MathJax.InputJax.TeX,
          MML = MathJax.ElementJax.mml;
      TEX.Definitions.macros.unit = \"jaxunit\";
      TEX.Definitions.macros.nicefrac = \"jaxfrac\";
      TEX.Parse.Augment({
          jaxunit: function (name) {
              var n = this.GetBrackets(name),
              unit = this.GetArgument(name)
              if (n == null) {n = \"\"}
              var tex = n + '\\\\,\\\\mathrm{'+unit+'}';
              this.string = tex + this.string.slice(this.i); this.i = 0;
          },
          jaxfrac: function (name) {
              var num = this.ParseArg(name),
                  den = this.ParseArg(name);
              this.Push(MML.mfrac(num,den).With({bevelled: true}));
          }
      });
  });
  MathJax.Hub.Queue(function () {
      document.getElementById(\"spinner\").style.display = \"none\";
  });
#+END_SRC
** Project definition
#+BEGIN_SRC emacs-lisp :noweb yes
    (unless (boundp 'org-publish-project-alist)
      (setq org-publish-project-alist nil))

    (setq org-html-style-default "")
    (setq org-html-htmlize-output-type 'css)

    (add-to-list
     'org-publish-project-alist
     `("html-documentation"
       :base-directory ,this-directory
       :base-extension "org"
       :publishing-directory ,(expand-file-name "html" doc-directory)
       :publishing-function org-html-publish-to-html
       :exclude "toc.org\\|macro"
       :recursive nil
       :section-numbers 3
       :with-toc        2
       :time-stamp-file nil
       :html-head "<link rel=\"stylesheet\" href=\"css/styles.css\" />
                   <link rel=\"stylesheet\" href=\"css/org-pygments.css\" />
                   <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/fontawesome.min.css\">
                   <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/brands.min.css\">
                   <link rel=\"icon\" href=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0
                         0 448 512' fill='gray'><path d='M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z'/></svg>\">"
       :html-preamble "__home_link__ __github_link__ __org_link__"
       :html-postamble "__cvs_version__"))
    (add-to-list
     'org-publish-project-alist
     `("html-documentation-recursive"
       :base-directory ,this-directory
       :base-extension "org"
       :publishing-directory ,(expand-file-name "html" doc-directory)
       :publishing-function org-html-publish-to-html
       :exclude "toc.org\\|macro"
       :recursive t
       :section-numbers 3
       :with-toc        2
       :time-stamp-file nil
       :html-head "<link rel=\"stylesheet\" href=\"css/styles.css\" />
                   <link rel=\"stylesheet\" href=\"css/org-pygments.css\" />
                   <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/fontawesome.min.css\">
                   <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/brands.min.css\">
                   <link rel=\"icon\" href=\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0
                         0 448 512' fill='gray'><path d='M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z'/></svg>\">"
       :html-preamble "__home_link__ __github_link__ __org_link__"
       :html-postamble "__cvs_version__"))
    (add-to-list
     'org-publish-project-alist
     `("html-documentation-twbs"
       :base-directory ,this-directory
       :base-extension "org"
       :publishing-directory ,(expand-file-name "html" doc-directory)
       :publishing-function org-twbs-publish-to-html
       :exclude "toc.org\\|macro"
       :recursive nil
       :section-numbers 3
       :with-toc        2
       :time-stamp-file nil
       :html-postamble "__cvs_version__"))
    (add-to-list
     'org-publish-project-alist
     `("html-documentation-twbs-recursive"
       :base-directory ,this-directory
       :base-extension "org"
       :publishing-directory ,(expand-file-name "html" doc-directory)
       :publishing-function org-twbs-publish-to-html
       :exclude "toc.org\\|macro"
       :recursive t
       :section-numbers 3
       :with-toc        2
       :time-stamp-file nil
       :html-postamble "__cvs_version__"))
  #+END_SRC
** Markup filtering
*** SN@ilWare keyword                                               :notused:
#+BEGIN_SRC emacs-lisp
  (defun html::filter-keyword (contents backend info)
    (when (eq backend 'html)
      (replace-regexp-in-string "SN@ilWare"
                                "<font style=\"text-decoration: overline;\">SN@il</font><font style=\"text-decoration: underline;\">Ware</font>"
                                contents)))
  ;;(add-to-list 'org-export-filter-final-output-functions 'html::filter-keyword)
#+END_SRC
*** Change frame of table and set it to void
#+BEGIN_SRC emacs-lisp
  (defun html::void-table-frame (contents backend info)
    (when (eq backend 'html)
      (replace-regexp-in-string "hsides" "void" contents)))
  (add-to-list 'org-export-filter-final-output-functions 'html::void-table-frame)
#+END_SRC
*** Remove =latex= tags
#+BEGIN_SRC emacs-lisp :tangle no
  (defun html::remove-latex-tags (contents backend info)
    (when (eq backend 'html)
      (replace-regexp-in-string "ignoresecnumber\\|ignoreheading" "" contents)))
  (add-to-list 'org-export-filter-headline-functions 'html::remove-latex-tags)
#+END_SRC
*** Tagging headline tags
Flag tags with a rounded rectangle filled with default color (used for example
for date/time reference)
#+BEGIN_SRC emacs-lisp
  (defun html::tagging-headline (contents backend info)
    (when (eq backend 'html)
      (replace-regexp-in-string ":\\(.*\\):</h\\([0-9]\\)" "<span class=\"tag\">\\1</span></h\\2" contents)))
  (add-to-list 'org-export-filter-headline-functions 'html::tagging-headline)
#+END_SRC
*** Remove toc and footnotes name
#+BEGIN_SRC emacs-lisp
    (defun html::remove-toc-footnote-name (contents backend info)
      (when (eq backend 'html)
        (replace-regexp-in-string ":\\(.*\\):</a>\n" "<span class=\"tag\" style=\"font-size:0.8em;\">\\1</span></a>"
        (replace-regexp-in-string "Table of Contents" ""
        (replace-regexp-in-string "Footnotes:" ""
        (replace-regexp-in-string "<body>" "<body onload=\"randomLinkColor();displayTOC();\"><div id=\"toc\"></div>"
        (replace-regexp-in-string "ignoresecnumber\\|ignoreheading" "" contents)
        ))))))
    (add-to-list 'org-export-filter-final-output-functions 'html::remove-toc-footnote-name)
#+END_SRC
*** Hook
**** Change image extension
#+BEGIN_SRC emacs-lisp
  (defun html::replace-img-ext-hook (backend)
    (when (eq backend 'html)
      (while (re-search-forward "[.]pdf" nil t)
        (replace-match  ".png"))
      ))
  ;;(add-hook 'org-export-before-processing-hook 'html::replace-img-ext-hook)
#+END_SRC
** CSS stylesheets
*** Main stylesheets
:PROPERTIES:
:HEADER-ARGS: :mkdirp yes :tangle (concat this-directory "doc/html/css/styles.css")
:END:
**** Google fonts
#+BEGIN_SRC css
  @import url(https://fonts.googleapis.com/css?family=Lato:300italic,700italic,300,700);
  @import url(https://fonts.googleapis.com/css?family=Open+Sans);
  @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,700);
  @import url(https://fonts.googleapis.com/css?family=Inconsolata);
#+END_SRC

**** Main =css= definitions
***** Body
#+BEGIN_SRC css
  body {
      width: 800px;
      margin: 0 auto;
      padding: 50px;
      color: #555555;
      font-family: 'Open Sans';
      font-size: 12pt;
      /*font: 14px/1.5 Lato, sans-serif;
      font-weight: 300;*/
  }
#+END_SRC

***** Headline
#+BEGIN_SRC css
  h1, h2, h3, h4, h5, h6 {
      font-family: "Yanone Kaffeesatz", sans-serif;
      margin:0 0 20px;
  }

  h1, h2, h3 {
      line-height:1.1;
  }

  h1 {
      color:#393939;
      margin: 0 0 40px;
      padding: 0;
      font-size: 300%;
  }

  h2 {
      color:#494949;
      font-size: 200%;
  }

  h3 {
      color:#555555;
      font-size: 175%;
  }

  h4, h5, h6 {
      color:#777777;
      font-size: 150%;
  }
#+END_SRC

Headline with custom id =hidden= are going to be hidden. In this way, I can use
headline trees but hide their content in the resulting html.
#+BEGIN_SRC css
  #hidden {
      display: none;
  }
#+END_SRC

***** Link
#+BEGIN_SRC css
  a {
      color: #67ad00;
      text-decoration:none;
  }

  a:hover {
      opacity:0.75;
  }

  a small {
      font-size:11px;
      color:#777777;
      margin-top:-0.6em;
      display:block;
  }

  a:hover small {
      opacity:0.75;
  }
#+END_SRC

***** Code, cite, table, image, tag
#+BEGIN_SRC css
  p, ul, ol, table, pre, dl {
      /*margin:0 0 20px;*/
  }

  blockquote {
      border-left:1px solid #e5e5e5;
      margin:0;
      padding:0 0 0 20px;
      font-style:italic;
  }

  code, pre {
      font-family:Inconsolata;
      color:#777777;
      font-size:12px;
  }

  code {
      display:inline-block;
      white-space:no-wrap;
      background:#fff;
      font-size:.8em;
      line-height:1.5em;
      border:1px solid #e5e5e5;
      -webkit-border-radius:0.4em;
      -moz-border-radius:0.4em;
      -ms-border-radius:0.4em;
      -o-border-radius:0.4em;
      border-radius:0.4em;
      padding:0 .3em;
      margin:-1px 0
  }

  pre {
      padding:8px 15px;
      background: #f8f8f8;
      border-radius:5px;
      border:1px solid #e5e5e5;
      overflow-x: auto;
  }

  cite {
      font-style: normal;
  }
  .tag {
       display:inline-block;
       white-space:no-wrap;
       background:#67ad00;
       color:#ffffff;
       float: right;
       font-size:.6em;
       line-height:1.5em;
       border:1px solid #e5e5e5;
       -webkit-border-radius:0.4em;
       -moz-border-radius:0.4em;
       -ms-border-radius:0.4em;
       -o-border-radius:0.4em;
       border-radius:0.4em;
       padding:0 .3em;
       margin:-1px 0
  }

  table {
      width:80%;
      border-collapse:collapse;
      margin-left:auto;
      margin-right:auto;
      margin-top: 20px;
  }

  .table-number {
      font-weight:700;
  }

  th, td {
      text-align:left;
      padding:5px 10px;
      border-bottom:1px solid #e5e5e5;
  }

  dt {
      color:#444444;
      font-weight:700;
  }

  th {
      color:#444444;
  }

  img {
      max-width:100%;
  }

  img.hidden {
      display: none;
  }

  .figure {
      text-align: center;
  }

  .figure-number {
      font-weight:700;
  }
#+END_SRC
***** Colored box (inherited from =beamer=)
#+BEGIN_SRC css
  .cbox {
      color:#67ad00;
  }

  .cbox p:before {
      font-family: FontAwesome;
      content: "\f02b ";
      display: inline-block;
      padding-right: 3px;
  }
#+END_SRC
***** Question environment (inherited from =latex=)
#+BEGIN_SRC css
  .question, .QUESTION {
      border-left:2px solid #67ad00;
      margin:0;
      padding:0 0 0 20px;
      font-style:italic;
      color: #67ad00;
  }
#+END_SRC
***** TOC
#+BEGIN_SRC css
  #table-of-contents {
      margin-bottom: 40px;
  }

  #table-of-contents .tag:hover {
      opacity:0.75;
  }

  #toc {
      position: fixed;
      top: 10px;
      right: 20px;
      z-index: 9999;
  }

  #toc .button {
      padding-right: 5px;
      position: fixed;
      right: inherit;
      cursor: default;
      font-size: 20px;
  }

  #toc div {
      height: 0;
      width: 0;
      margin-top: 35px;
      font-size: 11px;
      display: none;
  }

  #toc:hover div {
      width: 250px;
      height: auto;
      padding-right: 1.5em;
      background: #FFFFFF;
      /*opacity: .85;*/
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
      border-radius:4px;
      overflow: hidden;
      display: block;
  }

  #toc ul {
      color: #67ad00;
  }
#+END_SRC

Adding a small triangle on top to match the position of triggered icon
#+BEGIN_SRC css
  #toc:hover:before {
      content: "";
      position:absolute;
      top:19px;
      right:10px;
      width:0;height:0;
      border-color: transparent transparent rgba(0,0,0,0.03) transparent;
      border-width:8px;
      border-style:solid;
  }

  #toc:hover:after {
      content: "";
      position:absolute;
      top:20px;
      right:10px;
      width:0;height:0;
      border-color: transparent transparent #ffffff transparent;
      border-width:8px;
      border-style:solid;
  }
#+END_SRC

***** Spinners
When MathJax is loading, we replace the default messages of MathJax by some
spinners on the bottom-left side of the page
#+BEGIN_SRC css
  #spinner {
      position: fixed;
      bottom: 10px;
      left: 20px;
  }

  #spinner > div {
      width: 8px;
      height: 8px;
      background-color: #555555;
      border-radius: 100%;
      display: inline-block;
      -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
      animation: bouncedelay 1.4s infinite ease-in-out;
      /* Prevent first frame from flickering when animation starts */
      -webkit-animation-fill-mode: both;
      animation-fill-mode: both;
  }

  #spinner #bounce1 {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
  }

  #spinner #bounce2 {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
  }

  @-webkit-keyframes bouncedelay {
      0%, 80%, 100% { -webkit-transform: scale(0.0) }
      40% { -webkit-transform: scale(1.0) }
  }

  @keyframes bouncedelay {
      0%, 80%, 100% {
          transform: scale(0.0);
          -webkit-transform: scale(0.0);
      } 40% {
          transform: scale(1.0);
          -webkit-transform: scale(1.0);
      }
  }
#+END_SRC

***** Misc. (bold, =hr= style)
#+BEGIN_SRC css
  #content {
      width:700px;
      float:right;
      padding-bottom:50px;
  /* border:1px solid #e5e5e5; */
  /* border-width:1px 0; */
  /* padding:20px 0; */
  /* margin:0 0 20px; */
  }

  strong {
      color:#222;
      font-weight:700;
  }

  small {
      font-size:11px;
  }

  hr {
      border:0;
      background:#e5e5e5;
      height:1px;
      margin:0 0 20px;
  }

  .center {
      text-align:center;
  }

  .underline {
      font-weight: bold;
  }

  .footpara {
      display: inline;
  }
#+END_SRC

***** Scrollbars
#+BEGIN_SRC css
  .scrollbar-container {
      position: absolute;
      top: 0; bottom: 0; left: 0; right: 0;
      margin: 20px;

      border: 4px solid rgba(0, 0, 0, 0.2);
      overflow: auto;
      background-color: whiteSmoke;
  }
  .scrollbar-container .inner {
      height: 2011px;
      width: 1985px;
      padding: 1em;
      background-color: white;
      font-family: sans-serif;
  }
  ::-webkit-scrollbar {
      background: transparent;
  }
  ::-webkit-scrollbar-thumb {
      background-color: rgba(0, 0, 0, 0.2);
      border: solid whiteSmoke 4px;
      border-radius:15px;
  }
  ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(0, 0, 0, 0.3);
  }
#+END_SRC

***** Header
Nothing for the time being...
***** Footer
#+BEGIN_SRC css
  footer {
      width:270px;
      float:left;
      position:fixed;
      bottom:50px;
  }
#+END_SRC

***** Preamble, postamble
#+BEGIN_SRC css
  #preamble {
      position: fixed;
      top: 35px;
      right: 20px;
      padding-right: 5px;
      position: fixed;
      cursor: pointer;
      font-size: 20px;
  }

  #postamble {
      color: gray;
      clear: both;
      text-align: center;
      font-size:10px;
  }
#+END_SRC

***** Adapting media source
#+BEGIN_SRC css
  @media print, screen and (max-width: 960px) {

      body {
          width:auto;
          margin:0;
      }

      header, content, footer {
          float:none;
          position:static;
          width:auto;
      }

      header {
          padding-right:320px;
      }

      header a small {
          display:inline;
      }

      header ul {
          position:absolute;
          right:50px;
          top:52px;
      }
  }

  @media print, screen and (max-width: 720px) {
      body {
          word-wrap:break-word;
      }

      header {
          padding:0;
      }

      header ul, header p.view {
          position:static;
      }

      pre, code {
          word-wrap:normal;
      }
  }

  @media print, screen and (max-width: 480px) {
      body {
          padding:15px;
      }

      header ul {
          display:none;
      }
  }

  @media print {
      body {
          padding:0.4in;
          font-size:12pt;
          color:#444;
      }
  }
#+END_SRC

*** Org source code styles
:PROPERTIES:
:HEADER-ARGS: :mkdirp yes :tangle (concat this-directory "doc/html/css/org-pygments.css")
:END:

#+BEGIN_SRC css
  .org-string,
  .org-type {
      color: #DEB542;
  }

  .org-builtin,
  .org-variable-name,
  .org-constant,
  .org-function-name {
      color: #67ad00;
  }

  .org-comment,
  .org-comment-delimiter,
  .org-doc {
      color: #93a1a1;
  }

  .org-keyword {
      color: #69B7F0;/*#D33682;*/
  }

  pre {
      color: #777777;
  }
#+END_SRC

* LaTeX/PDF export
** =org= to LaTeX stuff
*** Use smart quote when exporting
#+BEGIN_SRC emacs-lisp
  (setq org-export-with-smart-quotes nil)
#+END_SRC
*** Use sans-serif font for TOC
#+BEGIN_SRC emacs-lisp
  (setq org-latex-toc-command "{\\sffamily\\tableofcontents}\n\n")
#+END_SRC
*** Place table caption below table
#+BEGIN_SRC emacs-lisp
  (setq org-latex-caption-above nil)
#+END_SRC
*** Force figure positionning
#+BEGIN_SRC emacs-lisp
  (setq org-latex-default-figure-position "!htb")
#+END_SRC

*** Code blocks
This activates a number of widely used languages, you are encouraged to activate
more languages using the customize interface for the =org-babel-load-languages=
variable, or with an elisp form like the one below.  The customize interface of
=org-babel-load-languages= contains an up to date list of the currently
supported languages.
#+BEGIN_SRC emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (latex . t)))
#+END_SRC

You are encouraged to add the following to your personal configuration
although it is not added by default as a security precaution.
#+BEGIN_SRC emacs-lisp
  (setq org-confirm-babel-evaluate nil)
  (add-to-list 'org-latex-minted-langs '(jupyter-python "python"))
#+END_SRC

*** Add =cite= link
#+BEGIN_SRC emacs-lisp
(org-add-link-type "cite" 'ebib
 (lambda (path desc format)
   (cond
    ((eq format 'html)  (format "(<cite>%s</cite>)" path))
    ((eq format 'latex) (format "\\cite{%s}" path)))))
#+END_SRC
*** Keep LaTeX logfiles
#+BEGIN_SRC emacs-lisp
  (setq org-latex-remove-logfiles nil)
#+END_SRC

*** Default list of LaTeX packages
Only include one default package and remove all the crapppy stuff included by
=org= \rightarrow =latex= translation.

#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-latex-packages-alist '("" "org-preamble"))
#+END_SRC
*** =minted= setup

Code fragments are syntax highlighted using [[https://code.google.com/p/minted/][minted]] LaTeX package
#+BEGIN_SRC emacs-lisp
  (setq org-latex-listings 'minted)
  (setq org-latex-minted-options
        '(("fontsize" "\\footnotesize")
          ("mathescape" "")
          ("xrightmargin" "0.5cm")
          ("xleftmargin"  "0.5cm")
          ))
#+END_SRC
*** Set LaTeX command
#+BEGIN_SRC emacs-lisp
  (setq org-latex-pdf-process '("latexmk -xelatex -shell-escape %f"))
#+END_SRC

*** Markup filter
**** Ignore headline
Add a new tag =ignoreheading= to skip headline tagged as such.
#+BEGIN_SRC emacs-lisp
  (defun latex::ignore-headline (contents backend info)
    (when (and (org-export-derived-backend-p backend 'latex)
               (string-match "\\`.*ignoreheading.*\n"
                             (downcase contents)))
      (replace-match "" nil nil contents)))
  (add-to-list 'org-export-filter-headline-functions 'latex::ignore-headline)
#+END_SRC

**** Tagging headline tags
Flag tags with a rounded rectangle filled with default color (used for example
for date/time reference)
#+BEGIN_SRC emacs-lisp
  (defun latex::tagging-headline (contents backend info)
    (when (org-export-derived-backend-p backend 'latex)
      (replace-regexp-in-string
       "\\\\textsc+" "\\\\mytag"
       (replace-regexp-in-string ":\\(.*\\):}" "\\\\hfill{}\\\\mytag{\\1}}" contents))))
  (add-to-list 'org-export-filter-headline-functions 'latex::tagging-headline)
#+END_SRC

**** SN@ilWare filter
#+BEGIN_SRC emacs-lisp
  (defun latex::snailware-keyword-filter (contents backend info)
    (when (eq backend 'latex)
      (replace-regexp-in-string "SN@ilware" "\\\\Snailware" contents)))
  (add-to-list 'org-export-filter-final-output-functions 'latex::snailware-keyword-filter)
#+END_SRC
**** Change =table= into =figure= env
When graphics are placed into table cells then change the default table
environment into figure
#+BEGIN_SRC emacs-lisp
  (defun latex::multicolumn-figure (contents backend info)
    (when (and (org-export-derived-backend-p backend 'latex)
               (string-match "table" contents)
               (string-match "includegraphics" contents))
      (replace-regexp-in-string "{table}" "{figure}" contents)))
  ;;(add-to-list 'org-export-filter-table-functions 'latex::multicolumn-figure)
#+END_SRC

**** Change =.org= extension to =.pdf=
#+BEGIN_SRC emacs-lisp
  (defun latex::filter-link (contents backend info)
    (when (org-export-derived-backend-p backend 'latex)
      (replace-regexp-in-string "\\\\.org" ".pdf" contents)))
  (add-to-list 'org-export-filter-link-functions 'latex::filter-link)
#+END_SRC
**** Change verbatim text
#+BEGIN_SRC emacs-lisp
  (defun latex::verbatim (contents backend info)
    (when (org-export-derived-backend-p backend 'latex)
      (replace-regexp-in-string "\\\\texttt" "\\\\myverb" contents)))
  ;;(add-to-list 'org-export-filter-verbatim-functions 'latex::verbatim)
#+END_SRC
**** Add email
#+BEGIN_SRC emacs-lisp
  (defun latex::add-email (options backend)
    "Insert EMAIL as \email{EMAIL} in the latex backend when EMAIL is present."
    (when (and (org-export-derived-backend-p backend 'latex)
               (plist-get options :with-email))
      (plist-put options :latex-header
                 (mapconcat 'identity
                            (remove nil
                                    (list
                                     (plist-get options :latex-header)
                                     (format "\\email{%s}" (plist-get options :email))))
                            "\n"))
      ;; don't insert email in \thanks{.}
      (plist-put options :with-email nil))
    options)

  (add-to-list 'org-export-filter-options-functions 'latex::add-email)
#+END_SRC

**** Lowercase =\begin/\end= environment
#+BEGIN_SRC emacs-lisp
  (defun latex::downcase-begin-filter (contents backend info)
    (when (org-export-derived-backend-p backend 'latex)
      (replace-regexp-in-string "\\\\begin{CBOX}"     "\\\\begin{cbox}"
      (replace-regexp-in-string "\\\\begin{QUESTION}" "\\\\begin{question}"
      (replace-regexp-in-string "\\\\begin{SNIPPET}"   "\\\\begin{snippet}"
      (replace-regexp-in-string "\\\\begin{REMARK}"   "\\\\begin{remark}"
      (replace-regexp-in-string "\\\\begin{ABSTRACT}" "\\\\begin{abstract}"
      (replace-regexp-in-string "\\\\begin{BIBLIOGRAPHY}" "\\\\begin{bibliography}"
                              contents))))))))
  (defun latex::downcase-end-filter (contents backend info)
    (when (org-export-derived-backend-p backend 'latex)
      (replace-regexp-in-string "\\\\end{CBOX}"     "\\\\end{cbox}"
      (replace-regexp-in-string "\\\\end{QUESTION}" "\\\\end{question}"
      (replace-regexp-in-string "\\\\end{SNIPPET}" "\\\\end{snippet}"
      (replace-regexp-in-string "\\\\end{REMARK}"   "\\\\end{remark}"
      (replace-regexp-in-string "\\\\end{ABSTRACT}" "\\\\end{abstract}"
      (replace-regexp-in-string "\\\\end{BIBLIOGRAPHY}" "\\\\end{bibliography}"
                              contents))))))))

  (add-to-list 'org-export-filter-final-output-functions 'latex::downcase-begin-filter)
  (add-to-list 'org-export-filter-final-output-functions 'latex::downcase-end-filter)
#+END_SRC

*** Templates
**** Default
#+BEGIN_SRC emacs-lisp
  (unless (boundp 'org-latex-classes)
    (setq org-latex-classes nil))

  (add-to-list 'org-latex-classes
               '("default-class"
                 "\\documentclass{scrartcl}
                  [PACKAGES]
                  \\usepackage{default-class-style}
                  \\usepackage{vc-style}
                  [NO-DEFAULT-PACKAGES]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
#+END_SRC
**** Teaching template
To be used, we would have to install [[https://github.com/xgarrido/latex-templates]]
#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-latex-classes
               '("teaching-class"
                 "\\documentclass{scrartcl}
                  [PACKAGES]
                  \\usepackage[oldschool]{teaching-classes-style}
                  \\usepackage{vc-style}
                  [NO-DEFAULT-PACKAGES]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
#+END_SRC
**** SuperNEMO template
To be used, we would have to install [[https://github.com/xgarrido/latex-templates]]
***** DocDB article
#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-latex-classes
               '("snemo-article"
                 "\\documentclass{scrartcl}
                  \\setkomafont{disposition}{\\normalfont\\bfseries}
                  [PACKAGES]
                  \\usepackage{supernemo-article-style}
                  \\usepackage{vc-style}
                  [NO-DEFAULT-PACKAGES]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
#+END_SRC
***** Note taking
#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-latex-classes
               '("snemo-note"
                 "\\documentclass{scrartcl}
                  [PACKAGES]
                  \\usepackage{supernemo-note-style}
                  \\usepackage{vc-style}
                  [NO-DEFAULT-PACKAGES]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
#+END_SRC
***** SN@ilWare markup filter
#+BEGIN_SRC emacs-lisp
  (defun snailware-markup-filter (contents backend info)
     (when (eq backend 'latex)
       (replace-regexp-in-string "SN@ilware" "\\\\Snailware" contents)))
   (add-to-list 'org-export-filter-final-output-functions 'snailware-markup-filter)
#+END_SRC

** LaTeX style files
*** VC status
:PROPERTIES:
:HEADER-ARGS: :mkdirp yes :tangle (concat this-directory "doc/pdf/vc-style.sty")
:END:

#+NAME: vc-status
#+BEGIN_SRC sh :results output :tangle no
  (
  cd $OGP_EXPORT_DIR
  if [ -d .svn ]; then
    status=$(LC_MESSAGES=en svn info)
    rev=$(echo -e $status | sed -n 's/.*Revision: *\([^ ]*\).*/\1/p')
    date=$(echo -e $status | sed -n 's/.*Last Changed Date: *\([^ ]*\).*/\1/p')
    url=$(echo -e $status | sed -n 's/.*URL: *\([^ ]*\).*/\1/p')
    log="\texttt{svn} revision \href{$url}{\color{gray}\texttt{${rev}}} \$-\$ ${date}"
  else
    url=$(git config --get remote.origin.url | sed -e 's#git@github.com:#https://github.com/#' -e 's#\.git##')
    log=$(LC_MESSAGES=en git --no-pager log -1 HEAD --date=short --pretty=format:"{\scriptsize\faGithub*} \ttfamily commit\href{$url/commit/%H}{\color{gray}\texttt{%h}} - %ad")
  fi
  echo "\renewcommand*{\PrelimText}{\small\textnormal{\color{gray}${log}}}"
  )
#+END_SRC

#+BEGIN_SRC latex :noweb yes
  \RequirePackage{ifthen}
  \RequirePackage{fontawesome5}
  \newboolean{@novc} %
  \setboolean{@novc}{false} %
  \DeclareOption{novc}{
    \setboolean{@novc}{true}
  }
  \ProcessOptions
  \ifthenelse{\boolean{@novc}}{}{
  \RequirePackage{prelim2e}
  <<vc-status()>>
  }
#+END_SRC

*** =org= preamble
:PROPERTIES:
:HEADER-ARGS: :mkdirp yes :tangle (concat this-directory "doc/pdf/org-preamble.sty")
:END:
**** Basics
#+BEGIN_SRC latex
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{org-preamble}[2013/03/03 v0.01 Bundling of Preamble items for Org to LaTeX export]
#+END_SRC

**** Packages requirements
***** AMS packages
#+BEGIN_SRC latex
  \RequirePackage{amsmath,amssymb}
#+END_SRC
***** Listings package
[[https://code.google.com/p/minted/][minted]] is a package that facilitates expressive syntax highlighting in LaTeX
using the powerful Pygments library. The package also provides options to
customize the highlighted source code output using =fancyvrb=.
#+BEGIN_SRC latex
  \RequirePackage[cache]{minted}
#+END_SRC

***** Unicode typesettings aka XeTeX
#+BEGIN_SRC latex
  \RequirePackage{ifxetex}
  \ifxetex
  \RequirePackage{fontspec}
  \RequirePackage{xunicode}
  %%\else
  \fi
#+END_SRC

***** hyperref package
#+BEGIN_SRC latex
  \RequirePackage{hyperref}
#+END_SRC
***** [[http://www.ctan.org/pkg/pifont][pifont]] package
#+BEGIN_SRC latex
  \RequirePackage{pifont}
#+END_SRC
***** graphics package
#+BEGIN_SRC latex
  \RequirePackage{wrapfig}
  \RequirePackage{graphicx}
  \graphicspath{
    {./plot/}
    {./figures/}
  }
#+END_SRC
***** =comment= package
#+BEGIN_SRC latex
  \RequirePackage{comment}
#+END_SRC
***** [[http://www.texample.net/tikz/][tikz]] package
#+BEGIN_SRC latex
  \RequirePackage{tikz}
  \usetikzlibrary{positioning,arrows,decorations,backgrounds,patterns,matrix,shapes,fit,calc,shadows,plotmarks,spy}
#+END_SRC

We use the external library from =tikz= to cache i.e. produce a =pdf= file of
each =tikzpicture=. =tikz/external= looks if the pdf exist and if not, export it.
#+BEGIN_SRC latex
  %%\tikzset{
  %%  external/system call={%
  %%    xelatex -shell-escape
  %%    -halt-on-error -interaction=batchmode
  %%    -jobname "\image" "\texsource"}}
  %%\tikzexternalize[prefix=latex.d/]
  \input "|mkdir -p latex.d"
  \input "|mkdir -p /tmp/latex.d"
#+END_SRC
***** =pgfplot= package
#+BEGIN_SRC latex
  \RequirePackage{pgfplots}
#+END_SRC
***** =rotating= package
This since to be needed if =sidewaystable= are used
#+BEGIN_SRC latex
  \RequirePackage{rotating}
#+END_SRC

***** Bold math package
#+BEGIN_SRC latex
  \RequirePackage{bm}
#+END_SRC
***** =multirow=
#+BEGIN_SRC latex
  \RequirePackage{multirow}
#+END_SRC
***** =units= package
#+BEGIN_SRC latex
  \RequirePackage{units}
#+END_SRC
***** =xspace= package
#+BEGIN_SRC latex
  \RequirePackage{xspace}
#+END_SRC

***** =array= package
#+BEGIN_SRC latex
  \RequirePackage{array}
  \newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
  \newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
  \newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
#+END_SRC

***** =underline= package
#+BEGIN_SRC latex
  \RequirePackage[normalem]{ulem}
#+END_SRC
***** =cancel= package
This package allows to cancel a number in LaTeX math mode
#+BEGIN_SRC latex
  \RequirePackage{cancel}
#+END_SRC

***** =relsize= package
#+BEGIN_SRC latex
  \RequirePackage{relsize}
#+END_SRC
***** Make =\(= and =\)= robust
Following [[http://tex.stackexchange.com/questions/113564/error-using-environment-inside-section-argument][this]] discussion, make =\(= and =\)= command robust.
#+BEGIN_SRC latex
  \RequirePackage{etoolbox}
  \robustify\(
  \robustify\)
#+END_SRC

***** =float= package
Prevent "Too many unprocessed floats" error
#+BEGIN_SRC latex
  \RequirePackage{float}
#+END_SRC
**** Email handling
#+BEGIN_SRC latex
  \let\@email\@empty
  \@ifundefined{email}{%
    \newcommand\email[1]{\gdef\@email{#1}}}{}
#+END_SRC
**** Generic new environment
***** Remark
#+BEGIN_SRC latex
  \newenvironment{remark}
                 {\begin{quote}\color{gray}\ding{47}\itshape\small}
                 {\end{quote}}
#+END_SRC
***** Prompt
#+BEGIN_SRC latex
  \newenvironment{prompt}
                 {\begin{quote}\color{blue!75}\tt\$\;}
                 {\end{quote}}
#+END_SRC
***** Bibliography
#+BEGIN_SRC latex
  \renewenvironment{bibliography}{%
   \small
   \@mkboth{\MakeUppercase\bibname}{\MakeUppercase\bibname}%
   \list{\@biblabel{\@arabic\c@enumiv}}%
        {\settowidth\labelwidth{\@biblabel{9}}%
          \leftmargin\labelwidth
          \advance\leftmargin\labelsep
          \@openbib@code
          \usecounter{enumiv}%
          \let\p@enumiv\@empty
          \renewcommand\theenumiv{\@arabic\c@enumiv}}%
        \sloppy
        \clubpenalty4000
        \@clubpenalty \clubpenalty
        \widowpenalty4000%
        \sfcode`\.\@m}{%
   \def\@noitemerr
       {\@latex@warning{Empty `thebibliography' environment}}%
       \endlist}
#+END_SRC

**** New commands
***** Clearing odd pages
#+BEGIN_SRC latex
  \RequirePackage{changepage}
  \newcommand\clearemptydoublepage{%
    \checkoddpage
    \ifthenelse{\boolean{oddpage}}%
               {\null\clearpage\thispagestyle{empty} \null \clearpage}%
               {\null\clearpage}%
  }
  %%\newcommand{\clearemptydoublepage}{\newpage{\cleardoubleemptypage\thispagestyle{empty}}
#+END_SRC
***** Tag
#+BEGIN_SRC latex
  \newrobustcmd{\mytag}[1]{\tikz[overlay]\node[fill=default,inner sep=2pt, anchor=text, rectangle, rounded corners=1mm] {\textcolor{white}{\smaller[2]{#1}}};\phantom{#1}}
#+END_SRC
***** Verbatim
#+BEGIN_SRC latex
  \newrobustcmd{\myverb}[1]{\tikz[overlay]\node[draw=gray,inner sep=2pt, anchor=text, rectangle, rounded corners=1mm, gray!80!black] {\smaller[0.75]{\texttt{#1}}};\phantom{#1}}
#+END_SRC

*** Default class style
:PROPERTIES:
:HEADER-ARGS: :mkdirp yes :tangle (concat this-directory "doc/pdf/default-class-style.sty")
:END:
**** Basics
#+BEGIN_SRC latex
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{default-class-style}[2014/10/25 v0.01 Bundling a default LaTeX class for org-pages]
#+END_SRC
**** Package requirements
***** =hyperref= package
#+BEGIN_SRC latex
  \hypersetup{
    xetex,
    colorlinks=true,
    urlcolor=default,
    filecolor=default,
    linkcolor=default,
    plainpages=false,
    pdfpagelabels,
    bookmarksnumbered,
    pagebackref
  }
#+END_SRC
**** Fonts
#+BEGIN_SRC latex
  \setmonofont[Scale=0.9]{Inconsolata}
  \setsansfont[Mapping=tex-text]{Myriad Pro}
  \setromanfont[Mapping=tex-text, Numbers=OldStyle]{Minion Pro}
  \RequirePackage[eulergreek,EULERGREEK]{sansmath}
  \RequirePackage{upgreek}
  \sansmath
#+END_SRC
**** Colors
#+BEGIN_SRC latex
  \definecolor{red}{HTML}{DD2A2B}
  \definecolor{green}{HTML}{69B628}
  \definecolor{blue}{HTML}{003399}
  \definecolor{orange}{HTML}{C08040}
  \definecolor{gray}{gray}{0.7}
  \colorlet{default}{blue}
#+END_SRC
**** Minted lexer
#+BEGIN_SRC latex
  \usemintedstyle{snemo}
#+END_SRC
**** Layout
***** Geometry
#+BEGIN_SRC latex
  \RequirePackage{a4wide}
  \linespread{1.02}
#+END_SRC
***** Cover page
#+BEGIN_SRC latex
  \newcommand{\HRule}{\rule{\linewidth}{1mm}}
  \renewcommand*{\maketitle}{%
    {\color{default}
    \pagestyle{empty}
    \vspace*{\stretch{2}}
    \begin{flushright}
      \HRule
      \\[9mm]
        {
          \bfseries\sffamily \Huge \@title
        }
        \\[5mm]
        \HRule
        \\[9mm]
    \end{flushright}}
  }
#+END_SRC
***** Footnote
#+BEGIN_SRC latex
  \RequirePackage{fancyhdr}
  \renewcommand{\footnoterule}{%
    \vskip-\footruleskip\vskip-\footrulewidth%
    \vspace{10pt}\hrule width\columnwidth height0pt \vspace{5pt} \color{gray}}
  \renewcommand{\thefootnote}{\alph{footnote}}
  \interfootnotelinepenalty=10000
#+END_SRC
***** Caption
#+BEGIN_SRC latex
  \RequirePackage[margin=20pt,labelfont=bf,font=footnotesize,labelsep=endash]{caption}
#+END_SRC
**** Appearance tweaks
***** Remove TOC dots
#+BEGIN_SRC latex
  \renewcommand\@dotsep{10000}
#+END_SRC
***** Change TOC name
#+BEGIN_SRC latex
\renewcommand{\contentsname}{}
#+END_SRC
***** Change section colors
#+BEGIN_SRC latex
  \RequirePackage{sectsty}
  \sectionfont{\color{default}}
#+END_SRC
***** SN@ilWare logo
#+BEGIN_SRC latex
  \RequirePackage{xspace}
  \def\Snailware{\mbox{$\overline{\text{SN@il}}$%
      \hspace{.05em}\protect\raisebox{.2ex}%
             {$\protect\underline{\text{Ware}}$}}\xspace}
#+END_SRC

** Project definition

#+BEGIN_SRC emacs-lisp
  (add-to-list
   'org-publish-project-alist
   `("pdf-documentation"
     :base-directory ,this-directory
     :base-extension "org"
     :publishing-directory ,(expand-file-name "pdf" doc-directory)
     :publishing-function org-latex-publish-to-pdf
     :exclude "toc.org"
     :recursive nil
     :section-numbers 2
     :with-toc        t
     :latex-class "default-class"
     :latex-header-extra ""
     ))
  (add-to-list
   'org-publish-project-alist
   `("pdf-documentation-recursive"
     :base-directory ,this-directory
     :base-extension "org"
     :publishing-directory ,(expand-file-name "pdf" doc-directory)
     :publishing-function org-latex-publish-to-pdf
     :exclude "toc.org"
     :recursive t
     :section-numbers 2
     :with-toc        t
     :latex-class "default-class"
     :latex-header-extra ""
     ))
#+END_SRC

* Exporter functions
#+BEGIN_SRC emacs-lisp
  (defun cp-readme-to-index ()
    (rename-file (expand-file-name "README.html" (expand-file-name "html" doc-directory))
                 (expand-file-name "index.html" (expand-file-name "html" doc-directory)) t))
  (defun org-publish-html ()
    (progn
      (org-publish-project "html-documentation" 'force)
      (cp-readme-to-index)
      ))
  (defun org-publish-html-recursive ()
    (progn
      (org-publish-project "html-documentation-recursive" 'force)
      (cp-readme-to-index)
      ))
  (defun org-publish-html-twbs ()
    (progn
      (org-publish-project "html-documentation-twbs" 'force)
      (cp-readme-to-index)
      ))
  (defun org-publish-html-twbs-recursive ()
    (progn
      (org-publish-project "html-documentation-twbs-recursive" 'force)
      (cp-readme-to-index)
      ))
#+END_SRC

#+BEGIN_SRC emacs-lisp
  (defun org-publish-pdf ()
    (progn
      (org-publish-project "pdf-documentation" 'force)
      ))
  (defun org-publish-pdf-recursive ()
    (progn
      (org-publish-project "pdf-documentation-recursive" 'force)
      ))
#+END_SRC
